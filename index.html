<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun&display=swap" rel="stylesheet">
<style>
body { font-family:'Sarabun', sans-serif; background:#f5f7fa; margin:0; padding:20px; }
h1 { text-align:center; color:#333; }
.container { display:grid; grid-template-columns:repeat(auto-fit, minmax(300px,1fr)); gap:15px; margin-top:20px; }
.card { background:#fff; padding:20px; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,0.1); }
.card h2 { font-size:1.2em; margin-bottom:10px; color:#0077cc; }
.card p { margin:5px 0; color:#444; }
.send-btn { margin-top:10px; background:#28a745; color:white; padding:8px 12px; border:none; border-radius:6px; cursor:pointer; }
.send-btn:hover { background:#218838; }
.manual { margin-top:30px; background:#fff; padding:15px; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,0.1); display:flex; flex-direction:column; align-items:center; }
.manual input { width:90%; padding:10px; margin:8px 0; border:1px solid #ccc; border-radius:5px; font-size:1rem; }
.manual button { width:90%; padding:10px; margin-top:10px; background:#007bff; color:white; border:none; border-radius:5px; cursor:pointer; }
.manual button:hover { background:#0069d9; }
</style>
</head>
<body>

<h1>üìö ‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô</h1>

<div class="container" id="homework-list"></div>

<div class="manual">
    <h3>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏≠‡∏á (‡∏™‡πà‡∏á LINE ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</h3>
    <input type="text" id="manual-subject" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤">
    <input type="text" id="manual-detail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
    <button onclick="addManualHomework()">‡πÄ‡∏û‡∏¥‡πà‡∏° & ‡∏™‡πà‡∏á LINE</button>
</div>

<script>
const sheetId = "1dObKpOKvBAOVr4B4aTWTbyoo8ElnHJqKKi4dGWiaDqk";
const sheetName = "HW";
const apiUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
const lineToken = "JUb7lM66V8CX1w2W/Wz+WbVOB6hLDurq8jY0jEHUuKGr4VwTOokhMGovEaYGDZUWUbIh5V7JptooJCyAkvEaUWEVUIm8asW8EzmhCdAqfmtqTUbibh4/uSXtbUVPbiC524EVWHm+6mXQirsAYejM8wdB04t89/1O/w1cDnyilFU=";
const lineGroup = "C818f3af969e10d8eeb8e13ef08647a2f";
const randomMessages = [
    "‚úèÔ∏è ‡∏£‡∏µ‡∏ö‡∏ó‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏π‡πÇ‡∏Å‡∏£‡∏ò‡∏ô‡∏∞!",
    "üìÖ ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏ó‡∏≥‡∏•‡πà‡∏∞ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô",
    "üî• ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß!",
    "üí™ ‡∏™‡∏π‡πâ ‡πÜ ‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!",
    "üìå ‡πÄ‡∏ä‡πá‡∏Ñ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢"
];

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î
function createCard(subject, detail, autoSend=false) {
    const container = document.getElementById("homework-list");
    const card = document.createElement("div");
    card.className = "card";
    card.innerHTML = `
        <h2>${subject}</h2>
        <p>${detail}</p>
        ${!autoSend ? '<button class="send-btn">‡∏™‡πà‡∏á LINE</button>' : ''}
    `;
    if(!autoSend){
        card.querySelector(".send-btn").addEventListener("click", ()=>sendLine(subject, detail));
    } else {
        sendLine(subject, detail);
    }
    container.appendChild(card);
}

// ‡∏™‡πà‡∏á LINE
function sendLine(subject, detail){
    const randomText = randomMessages[Math.floor(Math.random()*randomMessages.length)];
    const message = `üö®‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞\n‡∏ß‡∏¥‡∏ä‡∏≤ : ${subject}\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î : ${detail}\n${randomText}`;
    fetch("https://corsproxy.io/?https://api.line.me/v2/bot/message/push", {
        method:"POST",
        headers:{ "Content-Type":"application/json", "Authorization": `Bearer ${lineToken}` },
        body: JSON.stringify({ to: lineGroup, messages:[{ type:"text", text:message }] })
    })
    .then(res=>{ if(res.ok) alert("‡∏™‡πà‡∏á LINE ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ"); else alert("‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚ùå"); })
    .catch(err=>console.error(err));
}

// ‡∏î‡∏∂‡∏á‡∏á‡∏≤‡∏ô‡∏à‡∏≤‡∏Å Google Sheet
fetch(apiUrl)
    .then(res=>res.text())
    .then(data=>{
        const jsonData = JSON.parse(data.substr(47).slice(0,-2));
        const rows = jsonData.table.rows;
        rows.forEach(row=>{
            const subject = row.c[0]?.v || "";
            const detail = row.c[1]?.v || "";
            createCard(subject, detail);
        });
    })
    .catch(err=>console.error(err));

// ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÄ‡∏≠‡∏á + ‡∏™‡πà‡∏á LINE ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
function addManualHomework(){
    const subject = document.getElementById("manual-subject").value.trim();
    const detail = document.getElementById("manual-detail").value.trim();
    if(!subject || !detail){ alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö"); return; }
    createCard(subject, detail, true);
    document.getElementById("manual-subject").value = "";
    document.getElementById("manual-detail").value = "";
}
</script>

</body>
</html>
