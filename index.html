<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üìö ‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô</title>
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
<style>
    body { font-family: 'Sarabun', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; color: #333; }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    h1 { text-align: center; color: #2c3e50; font-weight: 700; margin-bottom: 40px; }
    .cards-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
    .card { background: #ffffff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); transition: transform 0.2s ease, box-shadow 0.2s ease; display: flex; flex-direction: column; }
    .card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15); }
    .card h2 { font-size: 1.3em; margin-bottom: 10px; color: #3498db; font-weight: 600; }
    .card p { margin: 5px 0; color: #555; flex-grow: 1; }
    .manual-input-section { margin-top: 40px; background: #ffffff; padding: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); }
    .manual-input-section h3 { font-size: 1.2em; color: #2c3e50; font-weight: 600; margin-bottom: 20px; }
    .manual-input-section input { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #e0e0e0; border-radius: 8px; font-size: 1rem; transition: border-color 0.3s ease, box-shadow 0.3s ease; box-sizing: border-box; }
    .manual-input-section input:focus { border-color: #3498db; outline: none; box-shadow: 0 0 5px rgba(52, 152, 219, 0.5); }
    .send-btn, .manual-btn { padding: 12px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: background-color 0.3s ease; text-align: center; margin-top: auto; }
    .send-btn { background-color: #2ecc71; color: #fff; }
    .send-btn:hover { background-color: #27ae60; }
    .manual-btn { background-color: #3498db; color: #fff; }
    .manual-btn:hover { background-color: #2980b9; }
</style>
</head>
<body>

<div class="container">
    <h1>üìö ‡πÅ‡∏à‡πâ‡∏á‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô</h1>
    <div class="cards-grid" id="homework-list"></div>

    <div class="manual-input-section">
        <h3>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏≠‡∏á (‡∏™‡πà‡∏á LINE ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥)</h3>
        <input type="text" id="manual-subject" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤">
        <input type="text" id="manual-detail" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
        <button id="add-manual-btn" class="manual-btn">‡πÄ‡∏û‡∏¥‡πà‡∏° & ‡∏™‡πà‡∏á LINE ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</button>
    </div>
</div>

<script>
    const sheetId = "1dObKpOKvBAOVr4B4aTWTbyoo8ElnHJqKKi4dGWiaDqk";
    const sheetName = "HW";
    const apiUrl = `https://docs.google.com/spreadsheets/d/${sheetId}/gviz/tq?tqx=out:json&sheet=${sheetName}`;
    const lineToken = "JUb7lM66V8CX1w2W/Wz+WbVOB6hLDurq8jY0jEHUuKGr4VwTOokhMGovEaYGDZUWUbIh5V7JptooJCyAkvEaUWEVUIm8asW8EzmhCdAqfmtqTUbibh4/uSXtbUVPbiC524EVWHm+6mXQirsAYejM8wdB04t89/1O/w1cDnyilFU=";
    const lineGroup = "C818f3af969e10d8eeb8e13ef08647a2f";
    const randomMessages = [
        "‚úèÔ∏è ‡∏£‡∏µ‡∏ö‡∏ó‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡∏£‡∏π‡πÇ‡∏Å‡∏£‡∏ò‡∏ô‡∏∞!",
        "üìÖ ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡∏ó‡∏≥‡∏•‡πà‡∏∞ ‡πÄ‡∏î‡∏µ‡πã‡∏¢‡∏ß‡πÑ‡∏°‡πà‡∏ó‡∏±‡∏ô",
        "üî• ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡πÄ‡∏ß‡∏•‡∏≤‡∏≠‡∏µ‡∏Å‡∏ô‡∏¥‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß!",
        "üí™ ‡∏™‡∏π‡πâ ‡πÜ ‡∏ô‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô!",
        "üìå ‡πÄ‡∏ä‡πá‡∏Ñ‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏î‡πâ‡∏ß‡∏¢"
    ];

    const homeworkList = document.getElementById("homework-list");
    const subjectInput = document.getElementById("manual-subject");
    const detailInput = document.getElementById("manual-detail");
    const addManualBtn = document.getElementById("add-manual-btn");

    function createCard(subject, detail, isManual = false) {
        const card = document.createElement("div");
        card.className = "card";
        card.innerHTML = `
            <h2>${subject}</h2>
            <p>${detail}</p>
            <button class="send-btn">‡∏™‡πà‡∏á LINE</button>
        `;
        const sendBtn = card.querySelector(".send-btn");
        sendBtn.addEventListener("click", () => sendLine(subject, detail));
        homeworkList.appendChild(card);

        if (isManual) {
            sendLine(subject, detail);
        }
    }

    function sendLine(subject, detail) {
        const randomText = randomMessages[Math.floor(Math.random() * randomMessages.length)];
        const message = `üö®‡πÉ‡∏Å‡∏•‡πâ‡∏ñ‡∏∂‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß‡∏ô‡∏∞\n‡∏ß‡∏¥‡∏ä‡∏≤ : ${subject}\n‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î : ${detail}\n${randomText}`;
        fetch("https://crossorigin.me/https://api.line.me/v2/bot/message/push", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${lineToken}`
            },
            body: JSON.stringify({
                to: lineGroup,
                messages: [{
                    type: "text",
                    text: message
                }]
            })
        })
        .then(res => {
            if (res.ok) alert("‡∏™‡πà‡∏á LINE ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ");
            else alert("‡∏™‡πà‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚ùå");
        })
        .catch(err => console.error(err));
    }

    function loadHomework() {
        fetch(apiUrl)
            .then(res => res.text())
            .then(data => {
                const jsonData = JSON.parse(data.substr(47).slice(0, -2));
                const rows = jsonData.table.rows;
                homeworkList.innerHTML = "";
                rows.forEach(row => {
                    const subject = row.c[0]?.v || "‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏¥‡∏ä‡∏≤";
                    const detail = row.c[1]?.v || "‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î";
                    createCard(subject, detail);
                });
            })
            .catch(err => console.error(err));
    }

    function addManualHomework() {
        const subject = subjectInput.value.trim();
        const detail = detailInput.value.trim();
        if (!subject || !detail) {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");
            return;
        }
        createCard(subject, detail, true);
        subjectInput.value = "";
        detailInput.value = "";
    }

    addManualBtn.addEventListener("click", addManualHomework);
    document.addEventListener("DOMContentLoaded", loadHomework);
</script>

</body>
</html>
